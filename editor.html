<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>楼盘规划图配置器</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/editor.css">
</head>
<body>

<div id="canvas-wrapper">
    <div id="empty-tip">请在右侧上传图片开始规划</div>
    <canvas id="editorCanvas"></canvas>
    <div id="zoom-info">缩放: 0%</div>
</div>

<div id="sidebar">
    <h3>🛠️ 楼盘数据配置</h3>

    <div id="topPane">
        <div class="step" id="step-upload">
            <label>1. 上传规划图/总平图</label>
            <input type="file" id="fileInput" accept="image/*">
            <div class="muted">支持拖拽、缩放、绘制多边形表示楼栋轮廓。</div>
        </div>

        <div class="step" id="step-scale">
            <label>2. 标定比例尺</label>
            <div class="muted" style="margin-bottom:5px;">
                状态: <span id="scaleStatus">未标定</span>
            </div>
            <button id="btnStartScale" disabled>开始标定 (点击两点)</button>
            <div id="scaleInputArea" style="display:none; margin-top:5px;">
                <label>两点间实际距离 (米):</label>
                <input type="number" id="realDistance" value="50" step="0.01" min="0">
                <button id="btnConfirmScale" class="secondary">确认比例</button>
            </div>
        </div>

        <div class="step active" id="step-draw">
            <label>3. 绘制楼栋</label>
            <div class="muted" style="margin-bottom:5px;">
                <span style="color:#28a745;">🖱️ 滚轮缩放，按住中键或空格拖拽视图</span><br>
                操作: 左键加点，左键双击结束；右键撤销上个点。
            </div>
            <button id="btnDrawMode" class="secondary">当前: ✋ 浏览模式</button>
            <button id="btnResetView" class="info" style="margin-top:5px;">⟲ 重置视角</button>
        </div>

        <div class="step" id="step-defaults">
            <label>4. 全局参数 & 默认值</label>
            
            <div class="location-config">
                <label>📍 项目位置（用于日照计算）</label>
                <div class="location-row">
                    <div class="field">
                        <span class="muted">选择城市</span>
                        <select id="citySelect">
                            <option value="">-- 加载中 --</option>
                        </select>
                    </div>
                    <div class="field">
                        <span class="muted">或输入纬度</span>
                        <input type="number" id="projectLat" value="36.65" step="0.01" min="-90" max="90">
                    </div>
                </div>
            </div>

            <label style="font-size:12px; color:#555; margin-bottom:5px;">新楼栋默认参数:</label>
            <div class="inline-inputs">
                <div class="field">
                    <span class="muted">默认层数</span>
                    <input type="number" id="defFloors" value="18" min="1" step="1">
                </div>
                <div class="field">
                    <span class="muted">默认层高(米)</span>
                    <input type="number" id="defFloorHeight" value="3" min="1" step="0.01">
                </div>
                <div class="field">
                    <span class="muted">默认户数/层</span>
                    <input type="number" id="defUnits" value="2" min="1" step="1">
                </div>
            </div>
            <div class="inline-row">
                <label style="margin:0; font-weight:normal;">
                    <input type="checkbox" id="defIsThisCommunity" checked> 默认标记为本小区
                </label>
            </div>
            <div class="inline-row">
                <label style="margin:0; font-weight:normal;">
                    <input type="checkbox" id="chkUseDefaults" checked> 新楼栋使用默认值
                </label>
                <button id="btnApplyDefaultsAll" class="btn-outline" style="width:auto;">应用到所有楼栋</button>
            </div>
        </div>
    </div>

    <div class="resizer" id="outerResizer" title="拖动以调整区域高度"></div>

    <div id="bottomPane">
        <div class="step" id="step-table" style="margin:0;">
            <label>5. 楼栋参数表（统一填写/编辑）</label>
        </div>

        <div class="resizer" id="tableResizer" title="拖动以调整表格高度"></div>

        <div id="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th style="width:200px;">名称（可编辑）</th>
                        <th style="width:90px;">层数</th>
                        <th style="width:110px;">层高(米)</th>
                        <th style="width:90px;">户/层</th>
                        <th style="width:84px;">本小区</th>
                        <th style="width:80px;">操作</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>

        <button id="btnExport" class="success" style="margin-top: 0;">导出 JSON 配置</button>
    </div>
</div>

<script src="js/cities.js"></script>
<script src="js/editor.js"></script>
</body>
</html>